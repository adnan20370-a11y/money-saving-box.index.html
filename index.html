<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Money Saving Box â€“ Fixed</title>
<style>
body{
    font-family: Arial, sans-serif;
    background:#f4f1ec;
    padding:20px;
    text-align:center;
    transition:.3s;
}
body.dark{background:#1e1e1e;color:#f4f1ec;}
h1{color:#3a1f12}
.grid{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(70px,1fr));
    gap:8px;
    max-width:600px;
    margin:auto;
    background:#6b3e26;
    padding:15px;
    border-radius:10px;
}
.cell{
    background:#fff;
    border:2px solid #3a1f12;
    padding:15px 5px;
    cursor:pointer;
    font-weight:bold;
    border-radius:5px;
}
.cell.saved{
    background:#c0392b;
    color:white;
    cursor:not-allowed;
}
.progress-container{
    width:90%;
    max-width:600px;
    margin:10px auto;
    background:#ddd;
    height:20px;
    border-radius:20px;
}
.progress-bar{
    height:100%;
    width:0%;
    background:linear-gradient(90deg,#4caf50,#81c784);
    border-radius:20px;
}
button{
    padding:10px 15px;
    margin:5px;
    cursor:pointer;
    border:none;
    background:#b71c1c;
    color:white;
    border-radius:5px;
}
</style>
</head>
<body>

<h1>ðŸ’° Money Saving Box</h1>

Goal: à§³<input type="number" id="goalInput" value="100000">
<button onclick="updateGoal()">Set Goal</button>

<div class="progress-container">
    <div class="progress-bar" id="progressBar"></div>
</div>

<div>Saved: à§³<span id="savedAmount">0</span> / à§³<span id="displayGoal">100000</span></div>
<div>Today Saved: à§³<span id="todayAmount">0</span></div>

<div class="grid" id="grid"></div>

<button onclick="undoLast()">Undo</button>
<button onclick="resetSavings()">Reset</button>
<button onclick="toggleTheme()">Dark / Light</button>

<script>
let TOTAL_GOAL = parseInt(localStorage.getItem("goal")) || 100000;
let amounts = JSON.parse(localStorage.getItem("amounts")) || [];
let saved = JSON.parse(localStorage.getItem("savedAmounts")) || [];
let lastSavedIndex = null;

// Today data
let todayData = JSON.parse(localStorage.getItem("todayData")) || {
    date:new Date().toDateString(),
    saved:0
};

if(todayData.date !== new Date().toDateString()){
    todayData.date = new Date().toDateString();
    todayData.saved = 0;
    localStorage.setItem("todayData",JSON.stringify(todayData));
}

document.getElementById("goalInput").value = TOTAL_GOAL;

// Generate amounts ONLY if not saved before
function generateAmounts(){
    amounts=[];
    let sum=0;
    while(sum<TOTAL_GOAL){
        let r=Math.random();
        let v=r<0.7?rand(10,200):r<0.9?rand(210,350):rand(360,500);
        if(sum+v>TOTAL_GOAL) v=TOTAL_GOAL-sum;
        amounts.push(v);
        sum+=v;
    }
    localStorage.setItem("amounts",JSON.stringify(amounts));
}

function rand(min,max){
    return Math.floor(Math.random()*((max-min)/10+1))*10+min;
}

function render(){
    const grid=document.getElementById("grid");
    grid.innerHTML="";
    amounts.forEach((v,i)=>{
        const d=document.createElement("div");
        d.className="cell";
        d.textContent=v;
        if(saved.includes(i)) d.classList.add("saved");
        d.onclick=()=>{
            if(saved.includes(i))return;
            saved.push(i);
            lastSavedIndex=i;
            todayData.saved+=v;
            localStorage.setItem("savedAmounts",JSON.stringify(saved));
            localStorage.setItem("todayData",JSON.stringify(todayData));
            updateUI();
        };
        grid.appendChild(d);
    });
}

function updateUI(){
    const total=saved.reduce((s,i)=>s+amounts[i],0);
    document.getElementById("savedAmount").textContent=total;
    document.getElementById("displayGoal").textContent=TOTAL_GOAL;
    document.getElementById("todayAmount").textContent=todayData.saved;
    document.getElementById("progressBar").style.width=(total/TOTAL_GOAL*100)+"%";
    render();
}

function resetSavings(){
    if(!confirm("Reset all?"))return;
    saved=[];
    todayData.saved=0;
    localStorage.removeItem("savedAmounts");
    localStorage.setItem("todayData",JSON.stringify(todayData));
    updateUI();
}

function undoLast(){
    if(lastSavedIndex===null)return alert("Nothing to undo");
    saved=saved.filter(i=>i!==lastSavedIndex);
    todayData.saved-=amounts[lastSavedIndex];
    if(todayData.saved<0)todayData.saved=0;
    localStorage.setItem("savedAmounts",JSON.stringify(saved));
    localStorage.setItem("todayData",JSON.stringify(todayData));
    lastSavedIndex=null;
    updateUI();
}

function toggleTheme(){
    document.body.classList.toggle("dark");
}

function updateGoal(){
    TOTAL_GOAL=parseInt(document.getElementById("goalInput").value);
    if(TOTAL_GOAL<1000)return alert("Min 1000");
    localStorage.setItem("goal",TOTAL_GOAL);
    saved=[];
    todayData.saved=0;
    localStorage.removeItem("savedAmounts");
    generateAmounts();
    updateUI();
}

// INIT
if(amounts.length===0) generateAmounts();
updateUI();
</script>

</body>
</html>
